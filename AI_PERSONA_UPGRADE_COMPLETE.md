# AI Persona Upgrade: From "Excel Tutor" to "CFO Advisor"

## Status: âœ… COMPLETE

## Executive Summary

Transformed AI suggestions from boring Excel tutorials into compelling business value propositions. The AI now speaks like a Senior CFO Advisor, not a software manual.

## Key Changes

### 1. Business Value First (The Why)

**Before** (Excel Tutor):
> "Create a Parameter sheet to organize hardcodes."

**After** (CFO Advisor):
> "ã“ã®å€¤ã¯423ç®‡æ‰€ã«åŸ‹ã‚è¾¼ã¾ã‚Œã¦ãŠã‚Šã€ã‚·ãƒŠãƒªã‚ªåˆ†æžãŒä¸å¯èƒ½ã§ã™ã€‚å–ç· å½¹ä¼šã§ã€Œã‚‚ã—ç‚ºæ›¿ãŒ10%å¤‰å‹•ã—ãŸã‚‰ï¼Ÿã€ã¨èžã‹ã‚Œã¦ã‚‚ã€å³ç­”ã§ãã¾ã›ã‚“ã€‚"

### 2. Smart Naming (The What)

**New Logic**: If Diffusion > 10, AI explicitly warns:

```
ã€é‡è¦: ã‚¹ãƒžãƒ¼ãƒˆãƒãƒ¼ãƒŸãƒ³ã‚°ã€‘
ã“ã®å€¤ã¯423ç®‡æ‰€ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€Œé–‹ç™ºè²»ã€ã¨ã„ã†ç‰¹å®šã‚³ã‚¹ãƒˆã§ã¯ãªãã€
ã‚°ãƒ­ãƒ¼ãƒãƒ«å‰ææ¡ä»¶ï¼ˆç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã€ç¨ŽçŽ‡ã€æˆé•·çŽ‡ãªã©ï¼‰ã®å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚

âŒ æ‚ªã„å‘½å: "é–‹ç™ºè²»" ï¼ˆèª¤è§£ã‚’æ‹›ãï¼‰
âœ… è‰¯ã„å‘½å: "USD_JPY_Rate" ã¾ãŸã¯ "Global_Tax_Rate" ï¼ˆæ±Žç”¨çš„ï¼‰
```

### 3. The Hook (The Benefit)

Every suggestion now ends with a "Pro Tip":

> ðŸ’¡ Pro Tip: ã“ã‚Œã«ã‚ˆã‚Šã€ä¼šè­°ä¸­ã®ã€ŒWhat-ifã€è³ªå•ã«å³åº§ã«å›žç­”ã§ãã¾ã™ã€‚

## Updated Personas

### Level 1: CFOã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ (Static Model)

**Focus**: ã‚·ãƒŠãƒªã‚ªåˆ†æžã®å®Ÿç¾

**Key Messages**:
- ãƒ“ã‚¸ãƒã‚¹ãƒªã‚¹ã‚¯: "ã‚·ãƒŠãƒªã‚ªåˆ†æžãŒä¸å¯èƒ½"
- ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤: "Best/Worst caseã‚’5ç§’ã§æ¯”è¼ƒå¯èƒ½"
- Pro Tip: "ä¼šè­°ä¸­ã®ã€ŒWhat-ifã€è³ªå•ã«å³åº§ã«å›žç­”"

**Tone**: Excelæ©Ÿèƒ½ã§ã¯ãªãã€Œå®‰å¿ƒæ„Ÿã€ã‚’å£²ã‚‹

### Level 2: ãƒªã‚¹ã‚¯ç®¡ç†ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ (Unstable Model)

**Focus**: ç›£æŸ»å¯¾å¿œã¨ä¿å®ˆæ€§

**Key Messages**:
- ãƒ“ã‚¸ãƒã‚¹ãƒªã‚¹ã‚¯: "ç›£æŸ»ã§èª¬æ˜Žã§ããªã„è¨ˆç®—ãƒ•ãƒ­ãƒ¼"
- ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤: "ç›£æŸ»å¯¾å¿œæ™‚é–“ãŒ1/10ã«"
- Pro Tip: "ç›£æŸ»ã‚„å¼•ç¶™ãŽæ™‚ã®è³ªå•ãŒæ¶ˆãˆã¾ã™"

**Tone**: æŠ€è¡“çš„æ­£ã—ã•ã§ã¯ãªãã€Œå®‰å¿ƒæ„Ÿã€ã‚’å£²ã‚‹

### Level 3: æˆ¦ç•¥ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ (Strategic Model)

**Focus**: æ„æ€æ±ºå®šé€Ÿåº¦ã¨ç«¶äº‰å„ªä½æ€§

**Key Messages**:
- æˆ¦ç•¥çš„æ©Ÿä¼š: "M&Aåˆ¤æ–­ã‚’3æ—¥ â†’ 30åˆ†ã«çŸ­ç¸®"
- ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤: "ç«¶åˆã‚ˆã‚Šé€Ÿãæ­£ç¢ºãªæ„æ€æ±ºå®š"
- Pro Tip: "çµŒå–¶é™£ã®è³ªå•ã«ä¼šè­°ä¸­ãã®å ´ã§å›žç­”"

**Tone**: Excelæ©Ÿèƒ½ã§ã¯ãªãã€Œç«¶äº‰å„ªä½æ€§ã€ã‚’å£²ã‚‹

## Technical Implementation

### Prompt Structure

All prompts now follow this structure:

```
ã€ãƒ“ã‚¸ãƒã‚¹ãƒªã‚¹ã‚¯ã€‘
ãªãœã“ã®ã¾ã¾ã ã¨å±é™ºã‹

ã€æŽ¨å¥¨ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã€‘
1. å…·ä½“çš„ãªæ‰‹é †1
2. å…·ä½“çš„ãªæ‰‹é †2
3. å…·ä½“çš„ãªæ‰‹é †3

ã€ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤ã€‘
âœ“ æ„æ€æ±ºå®šé€Ÿåº¦: ...
âœ“ ä¿å®ˆæ€§: ...
âœ“ ä¿¡é ¼æ€§: ...

ðŸ’¡ Pro Tip: å®Ÿå‹™ã§ã®æ´»ç”¨ã‚·ãƒ¼ãƒ³
```

### Smart Naming Logic

```python
if diffusion > 10:
    naming_guidance = f"""
ã“ã®å€¤ã¯{diffusion}ç®‡æ‰€ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã‚Œã¯ç‰¹å®šé …ç›®ã§ã¯ãªãã€ã‚°ãƒ­ãƒ¼ãƒãƒ«å‰ææ¡ä»¶ã§ã™ã€‚

âŒ æ‚ªã„å‘½å: "{row_label}"
âœ… è‰¯ã„å‘½å: "USD_JPY_Rate" ã¾ãŸã¯ "Global_Tax_Rate"
"""
```

### Context Injection

Now passing to AI:
- `diffusion`: å‡ºç¾å›žæ•°
- `dominance`: å½±éŸ¿ç¯„å›²
- `prescription_mode`: æŽ¨å¥¨ãƒ¢ãƒ¼ãƒ‰
- `row_label`: è¡Œãƒ©ãƒ™ãƒ«ï¼ˆã‚¹ãƒžãƒ¼ãƒˆãƒãƒ¼ãƒŸãƒ³ã‚°ã®åˆ¤æ–­ã«ä½¿ç”¨ï¼‰

## Before/After Examples

### Example 1: Hardcoded Value (Diffusion = 423)

**Before**:
> "ã“ã®å€¤ã‚’åå‰ä»˜ãç¯„å›²ã«ã—ã¾ã—ã‚‡ã†ã€‚å‰ææ¡ä»¶ã‚·ãƒ¼ãƒˆã‚’ä½œæˆã—ã€ã‚»ãƒ«å‚ç…§ã‚’ç½®æ›ã—ã¦ãã ã•ã„ã€‚"

**After**:
> "ã€ãƒ“ã‚¸ãƒã‚¹ãƒªã‚¹ã‚¯ã€‘
> ã“ã®å€¤ã¯423ç®‡æ‰€ã«åŸ‹ã‚è¾¼ã¾ã‚Œã¦ãŠã‚Šã€ã‚·ãƒŠãƒªã‚ªåˆ†æžãŒä¸å¯èƒ½ã§ã™ã€‚
> å–ç· å½¹ä¼šã§ã€Œã‚‚ã—ç‚ºæ›¿ãŒ10%å¤‰å‹•ã—ãŸã‚‰ï¼Ÿã€ã¨èžã‹ã‚Œã¦ã‚‚ã€å³ç­”ã§ãã¾ã›ã‚“ã€‚
> 
> ã€é‡è¦: ã‚¹ãƒžãƒ¼ãƒˆãƒãƒ¼ãƒŸãƒ³ã‚°ã€‘
> ã“ã®å€¤ã¯423ç®‡æ‰€ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€Œé–‹ç™ºè²»ã€ã§ã¯ãªãã€
> ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆãªã©ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å‰ææ¡ä»¶ã®å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚
> 
> âŒ æ‚ªã„å‘½å: "é–‹ç™ºè²»"
> âœ… è‰¯ã„å‘½å: "USD_JPY_Rate"
> 
> ã€æŽ¨å¥¨ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã€‘
> 1. ã€Œå‰ææ¡ä»¶ã€ã‚·ãƒ¼ãƒˆã‚’ä½œæˆ
> 2. A1ã«ã€ŒUSD_JPY_Rateã€ã¨å‘½å
> 3. æ•°å¼ â†’ åå‰ã®ç®¡ç† â†’ æ–°è¦ä½œæˆ
> 4. æ¤œç´¢ã¨ç½®æ›ã§423ç®‡æ‰€ã‚’ä¸€æ‹¬æ›´æ–°
> 
> ã€ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤ã€‘
> âœ“ ã‚·ãƒŠãƒªã‚ªåˆ†æž: Best/Worst caseã‚’5ç§’ã§æ¯”è¼ƒå¯èƒ½
> âœ“ æ„Ÿåº¦åˆ†æž: ç‚ºæ›¿å¤‰å‹•ã®å½±éŸ¿åº¦ã‚’å³åº§ã«å¯è¦–åŒ–
> âœ“ ä¿å®ˆæ€§: æ›´æ–°ä½œæ¥­ãŒ423ç®‡æ‰€ â†’ 1ç®‡æ‰€ã«å‰Šæ¸›
> 
> ðŸ’¡ Pro Tip: ã“ã‚Œã«ã‚ˆã‚Šã€ä¼šè­°ä¸­ã®ã€ŒWhat-ifã€è³ªå•ã«å³åº§ã«å›žç­”ã§ãã¾ã™ã€‚"

### Example 2: Circular Reference (Level 2)

**Before**:
> "å¾ªç’°å‚ç…§ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚è¨ˆç®—ãƒ•ãƒ­ãƒ¼ã‚’æ•´ç†ã—ã¦ãã ã•ã„ã€‚"

**After**:
> "ã€ãƒ“ã‚¸ãƒã‚¹ãƒªã‚¹ã‚¯ã€‘
> ã“ã®è¨ˆç®—ãƒ•ãƒ­ãƒ¼ã¯å¾ªç’°å‚ç…§ã‚’å«ã‚“ã§ãŠã‚Šã€ä»¥ä¸‹ã®ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ï¼š
> â€¢ ç›£æŸ»å¯¾å¿œ: è¨ˆç®—æ ¹æ‹ ã‚’èª¬æ˜Žã§ããªã„
> â€¢ ã‚¨ãƒ©ãƒ¼æ¤œå‡º: å•é¡Œç™ºç”Ÿæ™‚ã®åŽŸå› ç‰¹å®šã«æ•°æ™‚é–“
> â€¢ å¼•ç¶™ãŽ: å¾Œä»»è€…ãŒç†è§£ã§ããšã€å±žäººåŒ–
> 
> ã€æŽ¨å¥¨ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã€‘
> 1. ã€Œè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã€ã‚·ãƒ¼ãƒˆã‚’ä½œæˆ
> 2. ä¸­é–“è¨ˆç®—ã‚’æ˜Žç¤ºçš„ã«é…ç½®
> 3. å„ã‚¹ãƒ†ãƒƒãƒ—ã«èª¬æ˜Žãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ 
> 4. æœ€çµ‚çµæžœã®ã¿ã‚’ä»–ã‚·ãƒ¼ãƒˆã‹ã‚‰å‚ç…§
> 
> ã€ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤ã€‘
> âœ“ ç›£æŸ»å¯¾å¿œ: è¨ˆç®—ãƒ•ãƒ­ãƒ¼ãŒæ˜Žç¢ºã§ã€èª¬æ˜Žæ™‚é–“ãŒ1/10ã«
> âœ“ ä¿å®ˆæ€§: æ–°ãƒ¡ãƒ³ãƒãƒ¼ãŒ1æ—¥ã§ç†è§£å¯èƒ½
> âœ“ ä¿¡é ¼æ€§: ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®åŽŸå› ç‰¹å®šãŒ5åˆ†ä»¥å†…
> 
> ðŸ’¡ Pro Tip: ã“ã‚Œã«ã‚ˆã‚Šã€ç›£æŸ»ã‚„å¼•ç¶™ãŽæ™‚ã®ã€Œã“ã®ã‚»ãƒ«ã¯ä½•ã‚’è¨ˆç®—ã—ã¦ã‚‹ï¼Ÿã€ã¨ã„ã†è³ªå•ãŒæ¶ˆãˆã¾ã™ã€‚"

## Rules Enforced

### âŒ Prohibited (Excel Tutor Style)
- Excelæ©Ÿèƒ½ã®èª¬æ˜Žï¼ˆã€Œåå‰ä»˜ãç¯„å›²ã¨ã¯...ã€ï¼‰
- æŠ½è±¡çš„ãªææ¡ˆï¼ˆã€Œã‚·ãƒŠãƒªã‚ªåˆ†æžã‚’æ¤œè¨Žã—ã¦ãã ã•ã„ã€ï¼‰
- æŠ€è¡“ç”¨èªžã®ç¾…åˆ—ï¼ˆã€Œãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½¿ã„ã¾ã—ã‚‡ã†ã€ï¼‰

### âœ… Required (CFO Advisor Style)
- ãƒ“ã‚¸ãƒã‚¹ãƒªã‚¹ã‚¯ã®æ˜Žç¤ºï¼ˆã€Œã‚·ãƒŠãƒªã‚ªåˆ†æžãŒä¸å¯èƒ½ã€ï¼‰
- å…·ä½“çš„ãªä¾¡å€¤æç¤ºï¼ˆã€Œæ„æ€æ±ºå®šé€Ÿåº¦ãŒ10å€ã€ï¼‰
- å®Ÿå‹™ã‚·ãƒ¼ãƒ³ã®æç¤ºï¼ˆã€Œä¼šè­°ä¸­ã«å³ç­”ã€ï¼‰
- Pro Tipï¼ˆå®Ÿè·µçš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼‰

## Business Owner's Philosophy

> "Don't sell 'Excel features'. Sell 'Peace of Mind'."

The AI now sells:
- **Level 1**: ã‚·ãƒŠãƒªã‚ªåˆ†æžã®å®Ÿç¾ï¼ˆå®‰å¿ƒæ„Ÿï¼‰
- **Level 2**: ç›£æŸ»å¯¾å¿œã®å®¹æ˜“ã•ï¼ˆå®‰å¿ƒæ„Ÿï¼‰
- **Level 3**: æ„æ€æ±ºå®šã®é€Ÿåº¦ï¼ˆç«¶äº‰å„ªä½æ€§ï¼‰

## Files Modified

- `src/ai_explainer.py`
  - Updated `LEVEL_1_SYSTEM_PROMPT` (CFOã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼)
  - Updated `LEVEL_2_SYSTEM_PROMPT` (ãƒªã‚¹ã‚¯ç®¡ç†ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼)
  - Updated `LEVEL_3_SYSTEM_PROMPT` (æˆ¦ç•¥ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ)
  - Enhanced `_build_breakdown_prompt()` with smart naming logic
  - Added diffusion/dominance context injection

## Testing Recommendations

1. **Test with High Diffusion** (>10): Verify smart naming guidance appears
2. **Test Each Level**: Verify persona tone matches level
3. **Test Pro Tips**: Verify every suggestion ends with practical advice
4. **Test Business Value**: Verify no Excel feature explanations

## Success Metrics

- âœ… No Excel feature explanations
- âœ… Every suggestion has business risk section
- âœ… Every suggestion has business value section
- âœ… Every suggestion has Pro Tip
- âœ… Smart naming triggers for diffusion > 10
- âœ… Tone matches persona (Coach/Mechanic/Strategist â†’ CFO Advisor/Risk Manager/Strategic Consultant)

---

**Conclusion**: The AI now speaks the language of business, not the language of Excel. It sells peace of mind, not features.
